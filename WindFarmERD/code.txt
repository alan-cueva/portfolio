// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

TABLE WindFarm {
    ID INT [PRIMARY KEY, not null]
    Name VARCHAR [not null]
    CountryCode VARCHAR [not null]
    Latitude DECIMAL [not null]
    Longitude DECIMAL [not null]
    TotalCapacityMW DECIMAL [not null]
}

TABLE Turbine {
    ID INT [PRIMARY KEY, not null]
    FarmID INT [not null]
    Model VARCHAR [not null]
    CapacityMW DECIMAL [not null]
    InstallationDate DATE [not null]
    Latitude DECIMAL [not null]
    Longitude DECIMAL [not null]
}
Ref: Turbine.FarmID > WindFarm.ID

TABLE MaintenanceSchedule {
    ID INT [PRIMARY KEY, not null]
    TurbineID INT [not null]
    ScheduledDate DATE [not null]
    Notes VARCHAR [null]
    MaintenanceStatusID INT [not null]
    TurbineShutdownID INT [not null]
}
Ref: MaintenanceSchedule.TurbineID > Turbine.ID
Ref: MaintenanceSchedule.MaintenanceStatusID > MaintenanceStatus.ID
Ref: MaintenanceSchedule.TurbineShutdownID - TurbineShutdown.ID

// New, Assigned, Completed, Overdue, Cancelled, Failed
TABLE MaintenanceStatus {
    ID INT [primary key]
    Name VARCHAR [not null]
}

TABLE Incident {
    ID INT [PRIMARY KEY, not null]
    TurbineID INT [not null]
    Reported DATETIME [not null]
    Resolution DATETIME [null]
    Description TEXT [null]
    IncidentSeverityID INT [not null]
    IncidentStatusID INT [not null]
    TurbineShutdownID INT [not null]
}
Ref: Incident.TurbineID > Turbine.ID
Ref: Incident.IncidentStatusID > IncidentStatus.ID
Ref: Incident.IncidentSeverityID > IncidentSeverity.ID
Ref: Incident.TurbineShutdownID - TurbineShutdown.ID

// Reported, In Progress, Resolved, Cancelled
TABLE IncidentStatus {
    ID INT [primary key, not null]
    Name VARCHAR [not null]
}

// Minor, Major, Critical
TABLE IncidentSeverity {
    ID INT [primary key, not null]
    Name VARCHAR [not null]
}

TABLE TurbineShutdown {
    ID INT [PRIMARY KEY, not null]
    TurbineID INT [not null]
    TurnOff DATETIME [null]
    TurnOn DATETIME [null]
    Notes VARCHAR [null]
    TurbineShutdownTypeID INT [not null]
}
Ref: TurbineShutdown.TurbineID > Turbine.ID
Ref: TurbineShutdown.TurbineShutdownTypeID > TurbineShutdownType.ID

// Maintenance, Incident, Error, Weather, etc
TABLE TurbineShutdownType {
    ID INT [primary key, not null]
    Name VARCHAR [not null]
}

TABLE Technician {
    ID INT [PRIMARY KEY, not null]
    Name VARCHAR [not null]
    CertificationLevel INT [not null]
    Email VARCHAR [null]
    Phone VARCHAR [not null]
}

Table TechnicianMaintenance {
    ID INT [PRIMARY KEY, not null]
    Assigned DATETIME [not null]
    Finished DATETIME [null]
    TechnicianID INT [not null]
    MaintenanceScheduleID INT [not null]
}
Ref: TechnicianMaintenance.TechnicianID > Technician.ID
Ref: TechnicianMaintenance.MaintenanceScheduleID > MaintenanceSchedule.ID

Table TechnicianIncident {
    ID INT [PRIMARY KEY, not null]
    Assigned DATETIME [not null]
    Finished DATETIME [null]
    TechnicianID INT [not null]
    IncidentID INT [not null]
}
Ref: TechnicianIncident.TechnicianID > Technician.ID
Ref: TechnicianIncident.IncidentID > Incident.ID

TABLE SCADAData {
    ID BIGINT [PRIMARY KEY, not null]
    TurbineID INT [not null]
    Timestamp DATETIME
    WindSpeed DECIMAL
    StdDevWindSpeed DECIMAL // Wind speed standard deviation (m/s)
    WindDirAbs DECIMAL // absolute wind direction (deg)
    WindDirRel DECIMAL // Relative direction of nacelle with respect to WindDirAbs (deg)
    PowerOutputkW DECIMAL
    MaxPowerkW DECIMAL
    MinPowerkW DECIMAL
    StdDevPowerkW DECIMAL
    AvgRPower DECIMAL // Average reactive power output (kVAR)
    GeneratorRPM DECIMAL // Electrical generator revs per minute (RPM)
    RotorRPM DECIMAL // Wind turbine rotor revs per minute (RPM)
    EnvirTemp DECIMAL // Environmental temperature outside of nacelle (oC)
    NacelTemp DECIMAL // Temperature inside nacelle space (oC)
    GearOilTemp DECIMAL // Gearbox oil temperature (oC)
    GearBearTemp DECIMAL // Gearbox bearing temperature (oC)
    GeneratorTemp DECIMAL // Generator temperature (not active-999)
    GeneratorPh1Temp DECIMAL // Generator phase 1 winding temperature (oC)
    GeneratorPh2Temp DECIMAL // Generator phase 3 winding temperature (oC)
    GeneratorPh3Temp DECIMAL // Generator phase 3 winding temperature (oC)
    GeneratorBearTemp DECIMAL // Generator bearing temperature (oC)
}
Ref: SCADAData.TurbineID > Turbine.ID

====================================================================================

Constraints: Include 2-3 relevant business rules and data constraints

[Avoid duplicate entries]
CONSTRAINT TechnicianMaintenanceJunction UNIQUE TechnicianID, MaintenanceScheduleID)
CONSTRAINT TechnicianIncidentJunction UNIQUE (TechnicianID, IncidentID)
CONSTRAINT SCADAData UNIQUE (TurbineID, Timestamp)

CONSTRAINT TurbineShutdown
	IncidentID INT
    MaintenanceScheduleID INT
    Both cannot being NOT NULL or NULL

Unique constraints: Consider adding:
	Turbine(FarmID, Latitude, Longitude) — ensures no duplicate position per farm.
	MaintenanceStatus.Label / IncidentStatus.Label — make them unique for integrity.

